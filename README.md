# Battery


## Быстрый старт
Возможно 2 вида запуска программы для распознавания батареи на фотографии: 

Из Jupiter "Test_git.ipynb": 
1. Описано подключение к ClearMl, возможно изменение сервера для подключения, названия 
задачи, тегов и параметров запуска с сайта. 
2. Загрузка библиотек через run, чтобы не обновлять каждый раз блокнот
3. Пример работы с загрузкой датасета через класс Dataset_load (сопоставляет фото и координаты из json файла). 
Аугментация - контраст, яркость, насыщенность 
4. Обучение в течение 7 эпох 
5. Вывод метрик средней точности и среднего отзыва (пока для детекции result_box_10, для замены вывода метрик сегментации
заменить result_box_10 на result_seg_10 в первом окне)

Из консоли "only_test.py"

Данный файл выводит предсказания модели, содержит только фунции вывода и цикл обработки файлов. 
При вызове необходимо сначала указать путь для весов модели, например,  C:/Users/EVM/Documents/camera_test/weights/model_10_10_cpu.pt,
затем путь до папки с фото,например, C:\Users\EVM\Documents\camera_test\val\val и путь куда хотите, чтобы был сохранен
результат (обрезанное по предсказанной маске изображение), например, C:/Users/EVM/Documents/camera_test/result/result_only_test/

Из консоли "train.py"
Данный фал предназначен только для обучения модели, сохраняет полученные веса. На вход подается путь к изображениям, например,
root='C:/Users/EVM/Documents/camera_test/image2', путь к json файлу  - 
vgg_json='C:/Users/EVM/Documents/camera_test/battery_test/Anatation4.json, количество эпох, дата для сохранения в названии модели

Из консоли "test_git_2" 
Аналогичен блокноту Jupiter "Test_git.ipynb" содержит вывод аугментированного датасета, обучение, вывод графиков метрик,
вывод предсказанных масок.


## Подготовка к запуску
Скачайте из репозитория файлы: py для загрузки всех функций для работы программы, файл pt - веса модели, ipynb - для 
запусска из блокнота, py - для запуска из командной строки
Разместите в одной папке набор изображений и набор масок, если будете использовать в блокноте класс BatteryDataset.
Скачайте изображения и json 


***

# Описанеи файлов
НЕМНОГО УСТАРЕВШАЯ ИНФОРМАЦИЯ
Файл load_dataset.py 
Содержит описание класса BatteryDataset для загрузки датасета, состоящего из изображения и маски сделанной в фотошопе, 
рисует прямоугольники, ориентируясь на края маски. 
Содержит функцию бинаризации загружаемой маски, для того, чтобы пиксели яркости приравнять либо к 0, либо к 1.
Описание класса Dataset_load, который загружает маски в виде анатации в json файле
Описанs функции для аугментации изображений при помощи torchvision.transforms - get_transform_Batt, при помощи библиотеки
albumentations - get_transform_json. В обеих функциях на данный момент изменяется яркость, конрастность и цветопередачи.
Функции выбора цвета для предсказанной маски, функция предсказания, функция представления на изображении 
полученных данных. (Не работают при вызове из файла)

Файл engine.py
Содержит:
1. Описание функции обучения (def train_one_epoch)
2. Функции проверки точности предсказания модели (на тесторой выборке)(def evaluate)
3. Функция совмещающая train и test и обучающая нейронную сеть в течении определенного кол-ва эпох(def train_model)


Файл load_parametrs.py
Описана функция загрузки модели предварительно обученной на датасете coco. В ней заменяются только последние
слои детекции и сегментации

Файл vgg_to_mask.py 
Содержит функции для преобразования json файла в маски для обучения